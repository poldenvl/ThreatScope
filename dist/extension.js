"use strict";var ws=Object.create;var re=Object.defineProperty;var gs=Object.getOwnPropertyDescriptor;var _s=Object.getOwnPropertyNames;var Ss=Object.getPrototypeOf,Es=Object.prototype.hasOwnProperty;var bs=(r,e)=>()=>(r&&(e=r(r=0)),e);var p=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Mt=(r,e)=>{for(var t in e)re(r,t,{get:e[t],enumerable:!0})},At=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of _s(e))!Es.call(r,i)&&i!==t&&re(r,i,{get:()=>e[i],enumerable:!(s=gs(e,i))||s.enumerable});return r};var Rt=(r,e,t)=>(t=r!=null?ws(Ss(r)):{},At(e||!r||!r.__esModule?re(t,"default",{value:r,enumerable:!0}):t,r)),Dt=r=>At(re({},"__esModule",{value:!0}),r);var Pe=p(kt=>{"use strict";kt.parse=function(r,e){return new Ce(r,e).parse()};var Ce=class r{constructor(e,t){this.source=e,this.transform=t||Ts,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,s,i;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!i)this.dimension++,this.dimension>1&&(s=new r(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(t.value==="}"&&!i){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(i&&this.newEntry(!0),i=!i):t.value===","&&!i?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function Ts(r){return r}});var xe=p((Ca,qt)=>{var Cs=Pe();qt.exports={create:function(r,e){return{parse:function(){return Cs.parse(r,e)}}}}});var Bt=p((Pa,Lt)=>{"use strict";var Ps=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,xs=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Is=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Ms=/^-?infinity$/;Lt.exports=function(e){if(Ms.test(e))return Number(e.replace("i","I"));var t=Ps.exec(e);if(!t)return As(e)||null;var s=!!t[8],i=parseInt(t[1],10);s&&(i=Ot(i));var n=parseInt(t[2],10)-1,a=t[3],o=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),l=t[7];l=l?1e3*parseFloat(l):0;var f,m=Rs(e);return m!=null?(f=new Date(Date.UTC(i,n,a,o,u,c,l)),Ie(i)&&f.setUTCFullYear(i),m!==0&&f.setTime(f.getTime()-m)):(f=new Date(i,n,a,o,u,c,l),Ie(i)&&f.setFullYear(i)),f};function As(r){var e=xs.exec(r);if(e){var t=parseInt(e[1],10),s=!!e[4];s&&(t=Ot(t));var i=parseInt(e[2],10)-1,n=e[3],a=new Date(t,i,n);return Ie(t)&&a.setFullYear(t),a}}function Rs(r){if(r.endsWith("+00"))return 0;var e=Is.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var s=t==="-"?-1:1,i=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return i*s*1e3}}function Ot(r){return-(r-1)}function Ie(r){return r>=0&&r<100}});var Nt=p((xa,Qt)=>{Qt.exports=ks;var Ds=Object.prototype.hasOwnProperty;function ks(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Ds.call(t,s)&&(r[s]=t[s])}return r}});var jt=p((Ia,Ut)=>{"use strict";var qs=Nt();Ut.exports=k;function k(r){if(!(this instanceof k))return new k(r);qs(this,Ws(r))}var Os=["seconds","minutes","hours","days","months","years"];k.prototype.toPostgres=function(){var r=Os.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var Ls={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Bs=["years","months","days"],Qs=["hours","minutes","seconds"];k.prototype.toISOString=k.prototype.toISO=function(){var r=Bs.map(t,this).join(""),e=Qs.map(t,this).join("");return"P"+r+"T"+e;function t(s){var i=this[s]||0;return s==="seconds"&&this.milliseconds&&(i=(i+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),i+Ls[s]}};var Me="([+-]?\\d+)",Ns=Me+"\\s+years?",Fs=Me+"\\s+mons?",Us=Me+"\\s+days?",js="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Gs=new RegExp([Ns,Fs,Us,js].map(function(r){return"("+r+")?"}).join("\\s*")),Ft={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Hs=["hours","minutes","seconds","milliseconds"];function $s(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function Ws(r){if(!r)return{};var e=Gs.exec(r),t=e[8]==="-";return Object.keys(Ft).reduce(function(s,i){var n=Ft[i],a=e[n];return!a||(a=i==="milliseconds"?$s(a):parseInt(a,10),!a)||(t&&~Hs.indexOf(i)&&(a*=-1),s[i]=a),s},{})}});var Ht=p((Ma,Gt)=>{"use strict";Gt.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",s=0;s<e.length;)if(e[s]!=="\\")t+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))t+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var i=1;s+i<e.length&&e[s+i]==="\\";)i++;for(var n=0;n<Math.floor(i/2);++n)t+="\\";s+=Math.floor(i/2)*2}return new Buffer(t,"binary")}});var Jt=p((Aa,Yt)=>{var H=Pe(),$=xe(),se=Bt(),Wt=jt(),Kt=Ht();function ie(r){return function(t){return t===null?t:r(t)}}function Vt(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function Ks(r){return r?H.parse(r,Vt):null}function Vs(r){return parseInt(r,10)}function Ae(r){return r?H.parse(r,ie(Vs)):null}function zs(r){return r?H.parse(r,ie(function(e){return zt(e).trim()})):null}var Ys=function(r){if(!r)return null;var e=$.create(r,function(t){return t!==null&&(t=qe(t)),t});return e.parse()},Re=function(r){if(!r)return null;var e=$.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},P=function(r){if(!r)return null;var e=$.create(r);return e.parse()},De=function(r){if(!r)return null;var e=$.create(r,function(t){return t!==null&&(t=se(t)),t});return e.parse()},Js=function(r){if(!r)return null;var e=$.create(r,function(t){return t!==null&&(t=Wt(t)),t});return e.parse()},Zs=function(r){return r?H.parse(r,ie(Kt)):null},ke=function(r){return parseInt(r,10)},zt=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},$t=function(r){return r?H.parse(r,ie(JSON.parse)):null},qe=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},Xs=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",s=!1,i=2;i<r.length-1;i++){if(s||(e+=r[i]),r[i]===")"){s=!0;continue}else if(!s)continue;r[i]!==","&&(t+=r[i])}var n=qe(e);return n.radius=parseFloat(t),n},ei=function(r){r(20,zt),r(21,ke),r(23,ke),r(26,ke),r(700,parseFloat),r(701,parseFloat),r(16,Vt),r(1082,se),r(1114,se),r(1184,se),r(600,qe),r(651,P),r(718,Xs),r(1e3,Ks),r(1001,Zs),r(1005,Ae),r(1007,Ae),r(1028,Ae),r(1016,zs),r(1017,Ys),r(1021,Re),r(1022,Re),r(1231,Re),r(1014,P),r(1015,P),r(1008,P),r(1009,P),r(1040,P),r(1041,P),r(1115,De),r(1182,De),r(1185,De),r(1186,Wt),r(1187,Js),r(17,Kt),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,$t),r(3807,$t),r(3907,P),r(2951,P),r(791,P),r(1183,P),r(1270,P)};Yt.exports={init:ei}});var Xt=p((Ra,Zt)=>{"use strict";var b=1e6;function ti(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),s="";e<0&&(e=~e+(t===0),t=~t+1>>>0,s="-");var i="",n,a,o,u,c,l;{if(n=e%b,e=e/b>>>0,a=4294967296*n+t,t=a/b>>>0,o=""+(a-b*t),t===0&&e===0)return s+o+i;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";i=u+o+i}{if(n=e%b,e=e/b>>>0,a=4294967296*n+t,t=a/b>>>0,o=""+(a-b*t),t===0&&e===0)return s+o+i;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";i=u+o+i}{if(n=e%b,e=e/b>>>0,a=4294967296*n+t,t=a/b>>>0,o=""+(a-b*t),t===0&&e===0)return s+o+i;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";i=u+o+i}return n=e%b,a=4294967296*n+t,o=""+a%b,s+o+i}Zt.exports=ti});var ir=p((Da,sr)=>{var ri=Xt(),y=function(r,e,t,s,i){t=t||0,s=s||!1,i=i||function(C,be,Te){return C*Math.pow(2,Te)+be};var n=t>>3,a=function(C){return s?~C&255:C},o=255,u=8-t%8;e<u&&(o=255<<8-e&255,u=e),t&&(o=o>>t%8);var c=0;t%8+e>=8&&(c=i(0,a(r[n])&o,u));for(var l=e+t>>3,f=n+1;f<l;f++)c=i(c,a(r[f]),8);var m=(e+t)%8;return m>0&&(c=i(c,a(r[l])>>8-m,m)),c},rr=function(r,e,t){var s=Math.pow(2,t-1)-1,i=y(r,1),n=y(r,t,1);if(n===0)return 0;var a=1,o=function(c,l,f){c===0&&(c=1);for(var m=1;m<=f;m++)a/=2,(l&1<<f-m)>0&&(c+=a);return c},u=y(r,e,t+1,!1,o);return n==Math.pow(2,t+1)-1?u===0?i===0?1/0:-1/0:NaN:(i===0?1:-1)*Math.pow(2,n-s)*u},si=function(r){return y(r,1)==1?-1*(y(r,15,1,!0)+1):y(r,15,1)},er=function(r){return y(r,1)==1?-1*(y(r,31,1,!0)+1):y(r,31,1)},ii=function(r){return rr(r,23,8)},ni=function(r){return rr(r,52,11)},ai=function(r){var e=y(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,y(r,16,16)),s=0,i=[],n=y(r,16),a=0;a<n;a++)s+=y(r,16,64+16*a)*t,t/=1e4;var o=Math.pow(10,y(r,16,48));return(e===0?1:-1)*Math.round(s*o)/o},tr=function(r,e){var t=y(e,1),s=y(e,63,1),i=new Date((t===0?1:-1)*s/1e3+9466848e5);return r||i.setTime(i.getTime()+i.getTimezoneOffset()*6e4),i.usec=s%1e3,i.getMicroSeconds=function(){return this.usec},i.setMicroSeconds=function(n){this.usec=n},i.getUTCMicroSeconds=function(){return this.usec},i},W=function(r){for(var e=y(r,32),t=y(r,32,32),s=y(r,32,64),i=96,n=[],a=0;a<e;a++)n[a]=y(r,32,i),i+=32,i+=32;var o=function(c){var l=y(r,32,i);if(i+=32,l==4294967295)return null;var f;if(c==23||c==20)return f=y(r,l*8,i),i+=l*8,f;if(c==25)return f=r.toString(this.encoding,i>>3,(i+=l<<3)>>3),f;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,l){var f=[],m;if(c.length>1){var C=c.shift();for(m=0;m<C;m++)f[m]=u(c,l);c.unshift(C)}else for(m=0;m<c[0];m++)f[m]=o(l);return f};return u(n,s)},oi=function(r){return r.toString("utf8")},ui=function(r){return r===null?null:y(r,8)>0},ci=function(r){r(20,ri),r(21,si),r(23,er),r(26,er),r(1700,ai),r(700,ii),r(701,ni),r(16,ui),r(1114,tr.bind(null,!1)),r(1184,tr.bind(null,!0)),r(1e3,W),r(1007,W),r(1016,W),r(1008,W),r(1009,W),r(25,oi)};sr.exports={init:ci}});var ar=p((ka,nr)=>{nr.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var z=p(V=>{var hi=Jt(),li=ir(),di=xe(),fi=ar();V.getTypeParser=pi;V.setTypeParser=mi;V.arrayParser=di;V.builtins=fi;var K={text:{},binary:{}};function or(r){return String(r)}function pi(r,e){return e=e||"text",K[e]&&K[e][r]||or}function mi(r,e,t){typeof e=="function"&&(t=e,e="text"),K[e][r]=t}hi.init(function(r,e){K.text[r]=e});li.init(function(r,e){K.binary[r]=e})});var Y=p((Oa,Oe)=>{"use strict";Oe.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var q=z(),yi=q.getTypeParser(20,"text"),vi=q.getTypeParser(1016,"text");Oe.exports.__defineSetter__("parseInt8",function(r){q.setTypeParser(20,"text",r?q.getTypeParser(23,"text"):yi),q.setTypeParser(1016,"text",r?q.getTypeParser(1007,"text"):vi)})});var J=p((La,cr)=>{"use strict";var wi=Y();function gi(r){var e=r.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}function ur(r){for(var e="{",t=0;t<r.length;t++)t>0&&(e=e+","),r[t]===null||typeof r[t]>"u"?e=e+"NULL":Array.isArray(r[t])?e=e+ur(r[t]):r[t]instanceof Buffer?e+="\\\\x"+r[t].toString("hex"):e+=gi(ne(r[t]));return e=e+"}",e}var ne=function(r,e){if(r==null)return null;if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){var t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return r instanceof Date?wi.parseInputDatesAsUTC?Ei(r):Si(r):Array.isArray(r)?ur(r):typeof r=="object"?_i(r,e):r.toString()};function _i(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),ne(r.toPostgres(ne),e)}return JSON.stringify(r)}function S(r,e){for(r=""+r;r.length<e;)r="0"+r;return r}function Si(r){var e=-r.getTimezoneOffset(),t=r.getFullYear(),s=t<1;s&&(t=Math.abs(t)+1);var i=S(t,4)+"-"+S(r.getMonth()+1,2)+"-"+S(r.getDate(),2)+"T"+S(r.getHours(),2)+":"+S(r.getMinutes(),2)+":"+S(r.getSeconds(),2)+"."+S(r.getMilliseconds(),3);return e<0?(i+="-",e*=-1):i+="+",i+=S(Math.floor(e/60),2)+":"+S(e%60,2),s&&(i+=" BC"),i}function Ei(r){var e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);var s=S(e,4)+"-"+S(r.getUTCMonth()+1,2)+"-"+S(r.getUTCDate(),2)+"T"+S(r.getUTCHours(),2)+":"+S(r.getUTCMinutes(),2)+":"+S(r.getUTCSeconds(),2)+"."+S(r.getUTCMilliseconds(),3);return s+="+00:00",t&&(s+=" BC"),s}function bi(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var Ti=function(r){return'"'+r.replace(/"/g,'""')+'"'},Ci=function(r){for(var e=!1,t="'",s=0;s<r.length;s++){var i=r[s];i==="'"?t+=i+i:i==="\\"?(t+=i+i,e=!0):t+=i}return t+="'",e===!0&&(t=" E"+t),t};cr.exports={prepareValue:function(e){return ne(e)},normalizeQueryConfig:bi,escapeIdentifier:Ti,escapeLiteral:Ci}});var lr=p((Ba,hr)=>{"use strict";var Z=require("crypto");function Le(r){return Z.createHash("md5").update(r,"utf-8").digest("hex")}function Pi(r,e,t){var s=Le(e+r),i=Le(Buffer.concat([Buffer.from(s),t]));return"md5"+i}function xi(r){return Z.createHash("sha256").update(r).digest()}function Ii(r,e){return Z.createHmac("sha256",r).update(e).digest()}async function Mi(r,e,t){return Z.pbkdf2Sync(r,e,t,32,"sha256")}hr.exports={postgresMd5PasswordHash:Pi,randomBytes:Z.randomBytes,deriveKey:Mi,sha256:xi,hmacSha256:Ii,md5:Le}});var mr=p((Qa,pr)=>{var dr=require("crypto");pr.exports={postgresMd5PasswordHash:Ri,randomBytes:Ai,deriveKey:qi,sha256:Di,hmacSha256:ki,md5:Be};var fr=dr.webcrypto||globalThis.crypto,O=fr.subtle,Qe=new TextEncoder;function Ai(r){return fr.getRandomValues(Buffer.alloc(r))}async function Be(r){try{return dr.createHash("md5").update(r,"utf-8").digest("hex")}catch{let t=typeof r=="string"?Qe.encode(r):r,s=await O.digest("MD5",t);return Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("")}}async function Ri(r,e,t){var s=await Be(e+r),i=await Be(Buffer.concat([Buffer.from(s),t]));return"md5"+i}async function Di(r){return await O.digest("SHA-256",r)}async function ki(r,e){let t=await O.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await O.sign("HMAC",t,Qe.encode(e))}async function qi(r,e,t){let s=await O.importKey("raw",Qe.encode(r),"PBKDF2",!1,["deriveBits"]),i={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:t};return await O.deriveBits(i,s,32*8,["deriveBits"])}});var Fe=p((Na,Ne)=>{"use strict";var Oi=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Oi?Ne.exports=lr():Ne.exports=mr()});var gr=p((Fa,wr)=>{"use strict";var R=Fe();function Li(r){if(r.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=R.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}async function Bi(r,e,t){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let s=Fi(t);if(s.nonce.startsWith(r.clientNonce)){if(s.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var i="n=*,r="+r.clientNonce,n="r="+s.nonce+",s="+s.salt+",i="+s.iteration,a="c=biws,r="+s.nonce,o=i+","+n+","+a,u=Buffer.from(s.salt,"base64"),c=await R.deriveKey(e,u,s.iteration),l=await R.hmacSha256(c,"Client Key"),f=await R.sha256(l),m=await R.hmacSha256(f,o),C=ji(Buffer.from(l),Buffer.from(m)).toString("base64"),be=await R.hmacSha256(c,"Server Key"),Te=await R.hmacSha256(be,o);r.message="SASLResponse",r.serverSignature=Buffer.from(Te).toString("base64"),r.response=a+",p="+C}function Qi(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=Ui(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function Ni(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function yr(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function vr(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],s=e.substring(2);return[t,s]}))}function Fi(r){let e=vr(r),t=e.get("r");if(t){if(!Ni(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!yr(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let i=e.get("i");if(i){if(!/^[1-9][0-9]*$/.test(i))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let n=parseInt(i,10);return{nonce:t,salt:s,iteration:n}}function Ui(r){let t=vr(r).get("v");if(t){if(!yr(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function ji(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,s)=>r[s]^e[s]))}wr.exports={startSession:Li,continueSession:Bi,finalizeSession:Qi}});var Ue=p((Ua,_r)=>{"use strict";var Gi=z();function ae(r){this._types=r||Gi,this.text={},this.binary={}}ae.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};ae.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};ae.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};_r.exports=ae});var Er=p((ja,Sr)=>{"use strict";function je(r){if(r.charAt(0)==="/"){let o=r.split(" ");return{host:o[0],database:o[1]}}let e={},t,s=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)&&(r=encodeURI(r).replace(/\%25(\d\d)/g,"%$1"));try{t=new URL(r,"postgres://base")}catch{t=new URL(r.replace("@/","@___DUMMY___/"),"postgres://base"),s=!0}for(let o of t.searchParams.entries())e[o[0]]=o[1];if(e.user=e.user||decodeURIComponent(t.username),e.password=e.password||decodeURIComponent(t.password),t.protocol=="socket:")return e.host=decodeURI(t.pathname),e.database=t.searchParams.get("db"),e.client_encoding=t.searchParams.get("encoding"),e;let i=s?"":t.hostname;e.host?i&&/^%2f/i.test(i)&&(t.pathname=i+t.pathname):e.host=decodeURIComponent(i),e.port||(e.port=t.port);let n=t.pathname.slice(1)||null;e.database=n?decodeURI(n):null,(e.ssl==="true"||e.ssl==="1")&&(e.ssl=!0),e.ssl==="0"&&(e.ssl=!1),(e.sslcert||e.sslkey||e.sslrootcert||e.sslmode)&&(e.ssl={});let a=e.sslcert||e.sslkey||e.sslrootcert?require("fs"):null;switch(e.sslcert&&(e.ssl.cert=a.readFileSync(e.sslcert).toString()),e.sslkey&&(e.ssl.key=a.readFileSync(e.sslkey).toString()),e.sslrootcert&&(e.ssl.ca=a.readFileSync(e.sslrootcert).toString()),e.sslmode){case"disable":{e.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{e.ssl.rejectUnauthorized=!1;break}}return e}Sr.exports=je;je.parse=je});var He=p((Ga,Cr)=>{"use strict";var Hi=require("dns"),Tr=Y(),br=Er().parse,E=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||Tr[r]},$i=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Tr.ssl},L=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},x=function(r,e,t){var s=e[t];s!=null&&r.push(t+"="+L(s))},Ge=class{constructor(e){e=typeof e=="string"?br(e):e||{},e.connectionString&&(e=Object.assign({},e,br(e.connectionString))),this.user=E("user",e),this.database=E("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(E("port",e),10),this.host=E("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:E("password",e)}),this.binary=E("binary",e),this.options=E("options",e),this.ssl=typeof e.ssl>"u"?$i():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=E("client_encoding",e),this.replication=E("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=E("application_name",e,"PGAPPNAME"),this.fallback_application_name=E("fallback_application_name",e,!1),this.statement_timeout=E("statement_timeout",e,!1),this.lock_timeout=E("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=E("idle_in_transaction_session_timeout",e,!1),this.query_timeout=E("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var t=[];x(t,this,"user"),x(t,this,"password"),x(t,this,"port"),x(t,this,"application_name"),x(t,this,"fallback_application_name"),x(t,this,"connect_timeout"),x(t,this,"options");var s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(x(t,s,"sslmode"),x(t,s,"sslca"),x(t,s,"sslkey"),x(t,s,"sslcert"),x(t,s,"sslrootcert"),this.database&&t.push("dbname="+L(this.database)),this.replication&&t.push("replication="+L(this.replication)),this.host&&t.push("host="+L(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+L(this.client_encoding)),Hi.lookup(this.host,function(i,n){return i?e(i,null):(t.push("hostaddr="+L(n)),e(null,t.join(" ")))})}};Cr.exports=Ge});var Ir=p((Ha,xr)=>{"use strict";var Wi=z(),Pr=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,$e=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){var t;e.text?t=Pr.exec(e.text):t=Pr.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){for(var t=new Array(e.length),s=0,i=e.length;s<i;s++){var n=e[s];n!==null?t[s]=this._parsers[s](n):t[s]=null}return t}parseRow(e){for(var t={...this._prebuiltEmptyResultObject},s=0,i=e.length;s<i;s++){var n=e[s],a=this.fields[s].name;n!==null&&(t[a]=this._parsers[s](n))}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var t=0;t<e.length;t++){var s=e[t];this._types?this._parsers[t]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[t]=Wi.getTypeParser(s.dataTypeID,s.format||"text")}this._createPrebuiltEmptyResultObject()}_createPrebuiltEmptyResultObject(){for(var e={},t=0;t<this.fields.length;t++)e[this.fields[t].name]=null;this._prebuiltEmptyResultObject={...e}}};xr.exports=$e});var Dr=p(($a,Rr)=>{"use strict";var{EventEmitter:Ki}=require("events"),Mr=Ir(),Ar=J(),We=class extends Ki{constructor(e,t,s){super(),e=Ar.normalizeQueryConfig(e,t,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Mr(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Mr(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];return this.text&&t&&this.text!==t?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.isPreparedStatement=!0,this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Ar.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};Rr.exports=We});var ot=p(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.NoticeMessage=d.DataRowMessage=d.CommandCompleteMessage=d.ReadyForQueryMessage=d.NotificationResponseMessage=d.BackendKeyDataMessage=d.AuthenticationMD5Password=d.ParameterStatusMessage=d.ParameterDescriptionMessage=d.RowDescriptionMessage=d.Field=d.CopyResponse=d.CopyDataMessage=d.DatabaseError=d.copyDone=d.emptyQuery=d.replicationStart=d.portalSuspended=d.noData=d.closeComplete=d.bindComplete=d.parseComplete=void 0;d.parseComplete={name:"parseComplete",length:5};d.bindComplete={name:"bindComplete",length:5};d.closeComplete={name:"closeComplete",length:5};d.noData={name:"noData",length:5};d.portalSuspended={name:"portalSuspended",length:5};d.replicationStart={name:"replicationStart",length:4};d.emptyQuery={name:"emptyQuery",length:4};d.copyDone={name:"copyDone",length:4};var Ke=class extends Error{constructor(e,t,s){super(e),this.length=t,this.name=s}};d.DatabaseError=Ke;var Ve=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};d.CopyDataMessage=Ve;var ze=class{constructor(e,t,s,i){this.length=e,this.name=t,this.binary=s,this.columnTypes=new Array(i)}};d.CopyResponse=ze;var Ye=class{constructor(e,t,s,i,n,a,o){this.name=e,this.tableID=t,this.columnID=s,this.dataTypeID=i,this.dataTypeSize=n,this.dataTypeModifier=a,this.format=o}};d.Field=Ye;var Je=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};d.RowDescriptionMessage=Je;var Ze=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};d.ParameterDescriptionMessage=Ze;var Xe=class{constructor(e,t,s){this.length=e,this.parameterName=t,this.parameterValue=s,this.name="parameterStatus"}};d.ParameterStatusMessage=Xe;var et=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};d.AuthenticationMD5Password=et;var tt=class{constructor(e,t,s){this.length=e,this.processID=t,this.secretKey=s,this.name="backendKeyData"}};d.BackendKeyDataMessage=tt;var rt=class{constructor(e,t,s,i){this.length=e,this.processId=t,this.channel=s,this.payload=i,this.name="notification"}};d.NotificationResponseMessage=rt;var st=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};d.ReadyForQueryMessage=st;var it=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};d.CommandCompleteMessage=it;var nt=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};d.DataRowMessage=nt;var at=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};d.NoticeMessage=at});var kr=p(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.Writer=void 0;var ut=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var t=this.buffer.length-this.offset;if(t<e){var s=this.buffer,i=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(i),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){var t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};oe.Writer=ut});var Or=p(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.serialize=void 0;var ct=kr(),v=new ct.Writer,Vi=r=>{v.addInt16(3).addInt16(0);for(let s of Object.keys(r))v.addCString(s).addCString(r[s]);v.addCString("client_encoding").addCString("UTF8");var e=v.addCString("").flush(),t=e.length+4;return new ct.Writer().addInt32(t).add(e).flush()},zi=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},Yi=r=>v.addCString(r).flush(112),Ji=function(r,e){return v.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),v.flush(112)},Zi=function(r){return v.addString(r).flush(112)},Xi=r=>v.addCString(r).flush(81),qr=[],en=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||qr;for(var s=t.length,i=v.addCString(e).addCString(r.text).addInt16(s),n=0;n<s;n++)i.addInt32(t[n]);return v.flush(80)},B=new ct.Writer,tn=function(r,e){for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];s==null?(v.addInt16(0),B.addInt32(-1)):s instanceof Buffer?(v.addInt16(1),B.addInt32(s.length),B.add(s)):(v.addInt16(0),B.addInt32(Buffer.byteLength(s)),B.addString(s))}},rn=(r={})=>{let e=r.portal||"",t=r.statement||"",s=r.binary||!1,i=r.values||qr,n=i.length;return v.addCString(e).addCString(t),v.addInt16(n),tn(i,r.valueMapper),v.addInt16(n),v.add(B.flush()),v.addInt16(s?1:0),v.flush(66)},sn=Buffer.from([69,0,0,0,9,0,0,0,0,0]),nn=r=>{if(!r||!r.portal&&!r.rows)return sn;let e=r.portal||"",t=r.rows||0,s=Buffer.byteLength(e),i=4+s+1+4,n=Buffer.allocUnsafe(1+i);return n[0]=69,n.writeInt32BE(i,1),n.write(e,5,"utf-8"),n[s+5]=0,n.writeUInt32BE(t,n.length-4),n},an=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},ht=(r,e)=>{let s=4+Buffer.byteLength(e)+1,i=Buffer.allocUnsafe(1+s);return i[0]=r,i.writeInt32BE(s,1),i.write(e,5,"utf-8"),i[s]=0,i},on=v.addCString("P").flush(68),un=v.addCString("S").flush(68),cn=r=>r.name?ht(68,`${r.type}${r.name||""}`):r.type==="P"?on:un,hn=r=>{let e=`${r.type}${r.name||""}`;return ht(67,e)},ln=r=>v.add(r).flush(100),dn=r=>ht(102,r),ue=r=>Buffer.from([r,0,0,0,4]),fn=ue(72),pn=ue(83),mn=ue(88),yn=ue(99),vn={startup:Vi,password:Yi,requestSsl:zi,sendSASLInitialResponseMessage:Ji,sendSCRAMClientFinalMessage:Zi,query:Xi,parse:en,bind:rn,execute:nn,describe:cn,close:hn,flush:()=>fn,sync:()=>pn,end:()=>mn,copyData:ln,copyDone:()=>yn,copyFail:dn,cancel:an};ce.serialize=vn});var Lr=p(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.BufferReader=void 0;var wn=Buffer.allocUnsafe(0),lt=class{constructor(e=0){this.offset=e,this.buffer=wn,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};he.BufferReader=lt});var Nr=p(Q=>{"use strict";var gn=Q&&Q.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Q,"__esModule",{value:!0});Q.Parser=void 0;var w=ot(),_n=Lr(),Sn=gn(require("assert")),dt=1,En=4,Br=dt+En,Qr=Buffer.allocUnsafe(0),ft=class{constructor(e){if(this.buffer=Qr,this.bufferLength=0,this.bufferOffset=0,this.reader=new _n.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+Br<=s;){let n=this.buffer[i],a=this.buffer.readUInt32BE(i+dt),o=dt+a;if(o+i<=s){let u=this.handlePacket(i+Br,n,a,this.buffer);t(u),i+=o}else break}i===s?(this.buffer=Qr,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let i;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let n=this.buffer.byteLength*2;for(;t>=n;)n*=2;i=Buffer.allocUnsafe(n)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,s,i){switch(t){case 50:return w.bindComplete;case 49:return w.parseComplete;case 51:return w.closeComplete;case 110:return w.noData;case 115:return w.portalSuspended;case 99:return w.copyDone;case 87:return w.replicationStart;case 73:return w.emptyQuery;case 68:return this.parseDataRowMessage(e,s,i);case 67:return this.parseCommandCompleteMessage(e,s,i);case 90:return this.parseReadyForQueryMessage(e,s,i);case 65:return this.parseNotificationMessage(e,s,i);case 82:return this.parseAuthenticationResponse(e,s,i);case 83:return this.parseParameterStatusMessage(e,s,i);case 75:return this.parseBackendKeyData(e,s,i);case 69:return this.parseErrorMessage(e,s,i,"error");case 78:return this.parseErrorMessage(e,s,i,"notice");case 84:return this.parseRowDescriptionMessage(e,s,i);case 116:return this.parseParameterDescriptionMessage(e,s,i);case 71:return this.parseCopyInMessage(e,s,i);case 72:return this.parseCopyOutMessage(e,s,i);case 100:return this.parseCopyData(e,s,i);default:Sn.default.fail(`unknown message code: ${t.toString(16)}`)}}parseReadyForQueryMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.string(1);return new w.ReadyForQueryMessage(t,i)}parseCommandCompleteMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring();return new w.CommandCompleteMessage(t,i)}parseCopyData(e,t,s){let i=s.slice(e,e+(t-4));return new w.CopyDataMessage(t,i)}parseCopyInMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyInResponse")}parseCopyOutMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyOutResponse")}parseCopyMessage(e,t,s,i){this.reader.setBuffer(e,s);let n=this.reader.byte()!==0,a=this.reader.int16(),o=new w.CopyResponse(t,i,n,a);for(let u=0;u<a;u++)o.columnTypes[u]=this.reader.int16();return o}parseNotificationMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.cstring(),a=this.reader.cstring();return new w.NotificationResponseMessage(t,i,n,a)}parseRowDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new w.RowDescriptionMessage(t,i);for(let a=0;a<i;a++)n.fields[a]=this.parseField();return n}parseField(){let e=this.reader.cstring(),t=this.reader.int32(),s=this.reader.int16(),i=this.reader.int32(),n=this.reader.int16(),a=this.reader.int32(),o=this.reader.int16()===0?"text":"binary";return new w.Field(e,t,s,i,n,a,o)}parseParameterDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new w.ParameterDescriptionMessage(t,i);for(let a=0;a<i;a++)n.dataTypeIDs[a]=this.reader.int32();return n}parseDataRowMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new Array(i);for(let a=0;a<i;a++){let o=this.reader.int32();n[a]=o===-1?null:this.reader.string(o)}return new w.DataRowMessage(t,n)}parseParameterStatusMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring(),n=this.reader.cstring();return new w.ParameterStatusMessage(t,i,n)}parseBackendKeyData(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.int32();return new w.BackendKeyDataMessage(t,i,n)}parseAuthenticationResponse(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n={name:"authenticationOk",length:t};switch(i){case 0:break;case 3:n.length===8&&(n.name="authenticationCleartextPassword");break;case 5:if(n.length===12){n.name="authenticationMD5Password";let o=this.reader.bytes(4);return new w.AuthenticationMD5Password(t,o)}break;case 10:n.name="authenticationSASL",n.mechanisms=[];let a;do a=this.reader.cstring(),a&&n.mechanisms.push(a);while(a);break;case 11:n.name="authenticationSASLContinue",n.data=this.reader.string(t-8);break;case 12:n.name="authenticationSASLFinal",n.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return n}parseErrorMessage(e,t,s,i){this.reader.setBuffer(e,s);let n={},a=this.reader.string(1);for(;a!=="\0";)n[a]=this.reader.cstring(),a=this.reader.string(1);let o=n.M,u=i==="notice"?new w.NoticeMessage(t,o):new w.DatabaseError(o,t,i);return u.severity=n.S,u.code=n.C,u.detail=n.D,u.hint=n.H,u.position=n.P,u.internalPosition=n.p,u.internalQuery=n.q,u.where=n.W,u.schema=n.s,u.table=n.t,u.column=n.c,u.dataType=n.d,u.constraint=n.n,u.file=n.F,u.line=n.L,u.routine=n.R,u}};Q.Parser=ft});var pt=p(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.DatabaseError=M.serialize=M.parse=void 0;var bn=ot();Object.defineProperty(M,"DatabaseError",{enumerable:!0,get:function(){return bn.DatabaseError}});var Tn=Or();Object.defineProperty(M,"serialize",{enumerable:!0,get:function(){return Tn.serialize}});var Cn=Nr();function Pn(r,e){let t=new Cn.Parser;return r.on("data",s=>t.parse(s,e)),new Promise(s=>r.on("end",()=>s()))}M.parse=Pn});var Fr={};Mt(Fr,{default:()=>xn});var xn,Ur=bs(()=>{xn={}});var jr=p((Za,mt)=>{mt.exports.getStream=function(e){let t=require("net");if(typeof t.Socket=="function")return new t.Socket;{let{CloudflareSocket:s}=(Ur(),Dt(Fr));return new s(e)}};mt.exports.getSecureStream=function(e){var t=require("tls");return t.connect?t.connect(e):(e.socket.startTls(e),e.socket)}});var vt=p((eo,Gr)=>{"use strict";var Xa=require("net"),In=require("events").EventEmitter,{parse:Mn,serialize:_}=pt(),{getStream:An,getSecureStream:Rn}=jr(),Dn=_.flush(),kn=_.sync(),qn=_.end(),yt=class extends In{constructor(e){super(),e=e||{},this.stream=e.stream||An(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var t=this;this.on("newListener",function(s){s==="message"&&(t._emitMessage=!0)})}connect(e,t){var s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let i=function(n){s._ending&&(n.code==="ECONNRESET"||n.code==="EPIPE")||s.emit("error",n)};if(this.stream.on("error",i),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(n){var a=n.toString("utf8");switch(a){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}let o={socket:s.stream};s.ssl!==!0&&(Object.assign(o,s.ssl),"key"in s.ssl&&(o.key=s.ssl.key));var u=require("net");u.isIP&&u.isIP(t)===0&&(o.servername=t);try{s.stream=Rn(o)}catch(c){return s.emit("error",c)}s.attachListeners(s.stream),s.stream.on("error",i),s.emit("sslconnect")})}attachListeners(e){Mn(e,t=>{var s=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(s,t)})}requestSsl(){this.stream.write(_.requestSsl())}startup(e){this.stream.write(_.startup(e))}cancel(e,t){this._send(_.cancel(e,t))}password(e){this._send(_.password(e))}sendSASLInitialResponseMessage(e,t){this._send(_.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(_.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(_.query(e))}parse(e){this._send(_.parse(e))}bind(e){this._send(_.bind(e))}execute(e){this._send(_.execute(e))}flush(){this.stream.writable&&this.stream.write(Dn)}sync(){this._ending=!0,this._send(kn)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(qn,()=>{this.stream.end()})}close(e){this._send(_.close(e))}describe(e){this._send(_.describe(e))}sendCopyFromChunk(e){this._send(_.copyData(e))}endCopyFrom(){this._send(_.copyDone())}sendCopyFail(e){this._send(_.copyFail(e))}};Gr.exports=yt});var Kr=p((to,Wr)=>{"use strict";var{Transform:On}=require("stream"),{StringDecoder:Ln}=require("string_decoder"),A=Symbol("last"),le=Symbol("decoder");function Bn(r,e,t){let s;if(this.overflow){if(s=this[le].write(r).split(this.matcher),s.length===1)return t();s.shift(),this.overflow=!1}else this[A]+=this[le].write(r),s=this[A].split(this.matcher);this[A]=s.pop();for(let i=0;i<s.length;i++)try{$r(this,this.mapper(s[i]))}catch(n){return t(n)}if(this.overflow=this[A].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function Qn(r){if(this[A]+=this[le].end(),this[A])try{$r(this,this.mapper(this[A]))}catch(e){return r(e)}r()}function $r(r,e){e!==void 0&&r.push(e)}function Hr(r){return r}function Nn(r,e,t){switch(r=r||/\r?\n/,e=e||Hr,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=Hr)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=Bn,t.flush=Qn,t.readableObjectMode=!0;let s=new On(t);return s[A]="",s[le]=new Ln("utf8"),s.matcher=r,s.mapper=e,s.maxLength=t.maxLength,s.skipOverflow=t.skipOverflow||!1,s.overflow=!1,s._destroy=function(i,n){this._writableState.errorEmitted=!1,n(i)},s}Wr.exports=Nn});var Yr=p((ro,I)=>{"use strict";var Vr=require("path"),Fn=require("stream").Stream,Un=Kr(),zr=require("util"),jn=5432,de=process.platform==="win32",X=process.stderr,Gn=56,Hn=7,$n=61440,Wn=32768;function Kn(r){return(r&$n)==Wn}var N=["host","port","database","user","password"],wt=N.length,Vn=N[wt-1];function gt(){var r=X instanceof Fn&&X.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);X.write(zr.format.apply(zr,e))}}Object.defineProperty(I.exports,"isWin",{get:function(){return de},set:function(r){de=r}});I.exports.warnTo=function(r){var e=X;return X=r,e};I.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(de?Vr.join(e.APPDATA||"./","postgresql","pgpass.conf"):Vr.join(e.HOME||"./",".pgpass"));return t};I.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:de?!0:(e=e||"<unkn>",Kn(r.mode)?r.mode&(Gn|Hn)?(gt('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(gt('WARNING: password file "%s" is not a plain file',e),!1))};var zn=I.exports.match=function(r,e){return N.slice(0,-1).reduce(function(t,s,i){return i==1&&Number(r[s]||jn)===Number(e[s])?t&&!0:t&&(e[s]==="*"||e[s]===r[s])},!0)};I.exports.getPassword=function(r,e,t){var s,i=e.pipe(Un());function n(u){var c=Yn(u);c&&Jn(c)&&zn(r,c)&&(s=c[Vn],i.end())}var a=function(){e.destroy(),t(s)},o=function(u){e.destroy(),gt("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",o),i.on("data",n).on("end",a).on("error",o)};var Yn=I.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",s=0,i=0,n=0,a={},o=!1,u=function(l,f,m){var C=r.substring(f,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(C=C.replace(/\\([:\\])/g,"$1")),a[N[l]]=C},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),o=s==wt-1,o){u(s,i);break}c>=0&&e==":"&&t!=="\\"&&(u(s,i,c+1),i=c+2,s+=1)}return a=Object.keys(a).length===wt?a:null,a},Jn=I.exports.isValidEntry=function(r){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},t=0;t<N.length;t+=1){var s=e[t],i=r[N[t]]||"",n=s(i);if(!n)return!1}return!0}});var Zr=p((io,_t)=>{"use strict";var so=require("path"),Jr=require("fs"),fe=Yr();_t.exports=function(r,e){var t=fe.getFileName();Jr.stat(t,function(s,i){if(s||!fe.usePgPass(i,t))return e(void 0);var n=Jr.createReadStream(t);fe.getPassword(r,n,e)})};_t.exports.warnTo=fe.warnTo});var rs=p((no,ts)=>{"use strict";var Zn=require("events").EventEmitter,Xr=J(),St=gr(),Xn=Ue(),ea=He(),es=Dr(),ta=Y(),ra=vt(),sa=Fe(),pe=class extends Zn{constructor(e){super(),this.connectionParameters=new ea(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var t=e||{};this._Promise=t.Promise||global.Promise,this._types=new Xn(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=t.connection||new ra({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||ta.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=s=>{process.nextTick(()=>{s.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){var t=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let i=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(i)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){t.ssl?s.requestSsl():s.startup(t.getStartupConf())}),s.on("sslconnect",function(){s.startup(t.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let i=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(i),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(i):this._handleErrorEvent(i):this._connectionError||this._handleErrorEvent(i)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,s)=>{this._connect(i=>{i?s(i):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{t.emit("error",s)});else if(this.password!==null)e();else try{Zr()(this.connectionParameters,i=>{i!==void 0&&(this.connectionParameters.password=this.password=i),e()})}catch(s){this.emit("error",s)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let t=await sa.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=St.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await St.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{St.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,t={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(t.application_name=s),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){var s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,s){return this._types.setTypeParser(e,t,s)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return Xr.escapeIdentifier(e)}escapeLiteral(e){return Xr.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,s){var i,n,a,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,n=i=e,typeof t=="function"&&(i.callback=i.callback||t)):(a=this.connectionParameters.query_timeout,i=new es(e,t,s),i.callback||(n=new this._Promise((c,l)=>{i.callback=(f,m)=>f?l(f):c(m)}).catch(c=>{throw Error.captureStackTrace(c),c}))),a&&(u=i.callback,o=setTimeout(()=>{var c=new Error("Query read timeout");process.nextTick(()=>{i.handleError(c,this.connection)}),u(c),i.callback=()=>{};var l=this.queryQueue.indexOf(i);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},a),i.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!i.binary&&(i.binary=!0),i._result&&!i._result._types&&(i._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{i.handleError(new Error("Client was closed and is not queryable"),this.connection)}),n):(this.queryQueue.push(i),this._pulseQueryQueue(),n):(process.nextTick(()=>{i.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),n)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};pe.Query=es;ts.exports=pe});var as=p((ao,ns)=>{"use strict";var ia=require("events").EventEmitter,ss=function(){},is=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},Et=class{constructor(e,t,s){this.client=e,this.idleListener=t,this.timeoutId=s}},F=class{constructor(e){this.callback=e}};function na(){throw new Error("Release called on client which has already been released to the pool.")}function me(r,e){if(e)return{callback:e,result:void 0};let t,s,i=function(a,o){a?t(a):s(o)},n=new r(function(a,o){s=a,t=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:i,result:n}}function aa(r,e){return function t(s){s.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",s)}),r._remove(e),r.emit("error",s,e)}}var bt=class extends ia{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||Tt().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let s=t.client;s.ref&&s.ref();let i=t.idleListener;return this._acquireClient(s,e,i,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let t=is(this._idle,s=>s.client===e);t!==void 0&&clearTimeout(t.timeoutId),this._clients=this._clients.filter(s=>s!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let i=new Error("Cannot use a pool after calling end on the pool");return e?e(i):this.Promise.reject(i)}let t=me(this.Promise,e),s=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new F(t.callback)),s;let i=(o,u,c)=>{clearTimeout(a),t.callback(o,u,c)},n=new F(i),a=setTimeout(()=>{is(this._pendingQueue,o=>o.callback===i),n.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(n),s}return this.newClient(new F(t.callback)),s}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let s=aa(this,t);this.log("checking client timeout");let i,n=!1;this.options.connectionTimeoutMillis&&(i=setTimeout(()=>{this.log("ending client due to timeout"),n=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(a=>{if(i&&clearTimeout(i),t.on("error",s),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==t),n&&(a.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(a,void 0,ss);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new F((c,l,f)=>f()),s,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),t.once("end",()=>clearTimeout(o))}return this._acquireClient(t,e,s,!0)}})}_acquireClient(e,t,s,i){i&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),t.timedOut?i&&this.options.verify?this.options.verify(e,e.release):e.release():i&&this.options.verify?this.options.verify(e,n=>{if(n)return e.release(n),t.callback(n,void 0,ss);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let s=!1;return i=>{s&&na(),s=!0,this._release(e,t,i)}}_release(e,t,s){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",s,e),s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let n;this.options.idleTimeoutMillis&&(n=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&n.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Et(e,t,n)),this._pulseQueue()}query(e,t,s){if(typeof e=="function"){let n=me(this.Promise,e);return setImmediate(function(){return n.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),n.result}typeof t=="function"&&(s=t,t=void 0);let i=me(this.Promise,s);return s=i.callback,this.connect((n,a)=>{if(n)return s(n);let o=!1,u=c=>{o||(o=!0,a.release(c),s(c))};a.once("error",u),this.log("dispatching query");try{a.query(e,t,(c,l)=>{if(this.log("query dispatched"),a.removeListener("error",u),!o)return o=!0,a.release(c),c?s(c):s(void 0,l)})}catch(c){return a.release(c),s(c)}}),i.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let t=me(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};ns.exports=bt});var cs=p((oo,us)=>{"use strict";var os=require("events").EventEmitter,oa=require("util"),Ct=J(),U=us.exports=function(r,e,t){os.call(this),r=Ct.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};oa.inherits(U,os);var ua={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};U.prototype.handleError=function(r){var e=this.native.pq.resultErrorFields();if(e)for(var t in e){var s=ua[t]||t;r[s]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};U.prototype.then=function(r,e){return this._getPromise().then(r,e)};U.prototype.catch=function(r){return this._getPromise().catch(r)};U.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};U.prototype.submit=function(r){this.state="running";var e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;var t=function(n,a,o){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(o.length>1?a.forEach((u,c)=>{u.forEach(l=>{e.emit("row",l,o[c])})}):a.forEach(function(u){e.emit("row",u,o)})),e.state="end",e.emit("end",o),e.callback&&e.callback(null,o)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var s=(this.values||[]).map(Ct.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let n=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(n)}return r.native.execute(this.name,s,t)}return r.native.prepare(this.name,this.text,s.length,function(n){return n?t(n):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,s,t))})}else if(this.values){if(!Array.isArray(this.values)){let n=new Error("Query values must be an array");return t(n)}var i=this.values.map(Ct.prepareValue);r.native.query(this.text,i,t)}else r.native.query(this.text,t)}});var ps=p((uo,fs)=>{"use strict";var hs;try{hs=require("pg-native")}catch(r){throw r}var ca=Ue(),ls=require("events").EventEmitter,ha=require("util"),la=He(),ds=cs(),T=fs.exports=function(r){ls.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new ca(r.types),this.native=new hs({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new la(r);r.nativeConnectionString&&(e.nativeConnectionString=r.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};T.Query=ds;ha.inherits(T,ls);T.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};T.prototype._connect=function(r){var e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,s){if(e.connectionParameters.nativeConnectionString&&(s=e.connectionParameters.nativeConnectionString),t)return r(t);e.native.connect(s,function(i){if(i)return e.native.end(),r(i);e._connected=!0,e.native.on("error",function(n){e._queryable=!1,e._errorAllQueries(n),e.emit("error",n)}),e.native.on("notification",function(n){e.emit("notification",{channel:n.relname,payload:n.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};T.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(s=>{s?t(s):e()})})};T.prototype.query=function(r,e,t){var s,i,n,a,o;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")n=r.query_timeout||this.connectionParameters.query_timeout,i=s=r,typeof e=="function"&&(r.callback=e);else if(n=this.connectionParameters.query_timeout,s=new ds(r,e,t),!s.callback){let u,c;i=new this._Promise((l,f)=>{u=l,c=f}).catch(l=>{throw Error.captureStackTrace(l),l}),s.callback=(l,f)=>l?c(l):u(f)}return n&&(o=s.callback,a=setTimeout(()=>{var u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),o(u),s.callback=()=>{};var c=this._queryQueue.indexOf(s);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},n),s.callback=(u,c)=>{clearTimeout(a),o(u,c)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),i):(this._queryQueue.push(s),this._pulseQueryQueue(),i):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),i)};T.prototype.end=function(r){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));var t;return r||(t=new this._Promise(function(s,i){r=n=>n?i(n):s()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};T.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};T.prototype._pulseQueryQueue=function(r){if(this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);var t=this;e.once("_done",function(){t._pulseQueryQueue()})}};T.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};T.prototype.ref=function(){};T.prototype.unref=function(){};T.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};T.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var Pt=p((co,ms)=>{"use strict";ms.exports=ps()});var Tt=p((lo,ee)=>{"use strict";var da=rs(),fa=Y(),pa=vt(),ma=as(),{DatabaseError:ya}=pt(),{escapeIdentifier:va,escapeLiteral:wa}=J(),ga=r=>class extends ma{constructor(t){super(t,r)}},xt=function(r){this.defaults=fa,this.Client=r,this.Query=this.Client.Query,this.Pool=ga(this.Client),this._pools=[],this.Connection=pa,this.types=z(),this.DatabaseError=ya,this.escapeIdentifier=va,this.escapeLiteral=wa};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ee.exports=new xt(Pt()):(ee.exports=new xt(da),Object.defineProperty(ee.exports,"native",{configurable:!0,enumerable:!1,get(){var r=null;try{r=new xt(Pt())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ee.exports,"native",{value:r}),r}}))});var Ea={};Mt(Ea,{ErrorTreeItem:()=>D,ErrorsProvider:()=>Ee,activate:()=>_a,deactivate:()=>Sa});module.exports=Dt(Ea);var h=Rt(require("vscode")),It=Rt(Tt()),ye,ve,we,ge,_e,Se,g=h.workspace.getConfiguration("threatscope"),te=new It.Pool({user:g.get("DB.Login"),host:g.get("DB.Host"),database:g.get("DB.DataBase"),password:g.get("DB.Password"),port:g.get("DB.Port")});async function _a(r){h.commands.registerCommand("threatscope.activate",o=>h.window.showInformationMessage("Starting ThreatScope..."));let e,t="threatscope.changeSeverity",s=async(o,u)=>{await ys(o,u.replace(/_/g," ")),e=await G(h.window.activeTextEditor?.document.uri.fsPath),j(e),a.refresh(e)},i="threatscope.changeStatus",n=async(o,u)=>{await vs(o,u.replace(/_/g," ")),e=await G(h.window.activeTextEditor?.document.uri.fsPath),j(e),a.refresh(e)};r.subscriptions.push(h.commands.registerCommand(t,s)),r.subscriptions.push(h.commands.registerCommand(i,n));let a=new Ee;if(h.window.registerTreeDataProvider("errorsTree",a),h.window.createTreeView("errorsTree",{treeDataProvider:a}),h.window.activeTextEditor?.document.uri.fsPath!==void 0){try{e=await G(h.window.activeTextEditor?.document.uri.fsPath)}catch(o){let u=o.message;h.window.showErrorMessage(u)}h.window.showInformationMessage(`Found ${e.length} errors in: ${h.window.activeTextEditor?.document.uri.fsPath}`),j(e),a.refresh(e)}h.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration("threatscope")&&(g=h.workspace.getConfiguration("threatscope"),te=new It.Pool({user:g.get("DB.Login"),host:g.get("DB.Host"),database:g.get("DB.DataBase"),password:g.get("DB.Password"),port:g.get("DB.Port")}))}),h.window.onDidChangeActiveTextEditor(async o=>{if(h.window.activeTextEditor?.document.uri.fsPath===void 0)return;let u;try{u=await G(h.window.activeTextEditor?.document.uri.fsPath)}catch(c){let l=c.message;h.window.showErrorMessage(l)}h.window.showInformationMessage(`Found ${u.length} errors in: ${h.window.activeTextEditor?.document.uri.fsPath}`),j(u),a.refresh(u)})}function j(r){ye!==void 0&&ye.dispose(),ve!==void 0&&ve.dispose(),we!==void 0&&we.dispose(),ge!==void 0&&ge.dispose(),_e!==void 0&&_e.dispose(),Se!==void 0&&Se.dispose();let e=[],t=[],s=[],i=[],n=[],a=[];ye=h.window.createTextEditorDecorationType({backgroundColor:"rgba("+g.get("Colour.Status.NotConfirmed")+")",opacity:"100%",isWholeLine:!0}),ve=h.window.createTextEditorDecorationType({backgroundColor:"rgba("+g.get("Colour.Severity.LowSeverity")+")",opacity:"100%",isWholeLine:!0}),we=h.window.createTextEditorDecorationType({backgroundColor:"rgba("+g.get("Colour.Severity.MediumSeverity")+")",opacity:"100%",isWholeLine:!0}),ge=h.window.createTextEditorDecorationType({backgroundColor:"rgba("+g.get("Colour.Severity.HighSeverity")+")",opacity:"100%",isWholeLine:!0}),_e=h.window.createTextEditorDecorationType({backgroundColor:"rgba("+g.get("Colour.Severity.CriticalSeverity")+")",opacity:"100%",isWholeLine:!0}),Se=h.window.createTextEditorDecorationType({backgroundColor:"rgba("+g.get("Colour.Severity.UnknownSeverity")+")",opacity:"100%",isWholeLine:!0}),r.forEach(o=>{let u=new h.Position(Number(o.line)-1,0),c=new h.Range(u,u),l=new h.MarkdownString("Status: "+o.statusname+`  
Severity: `+o.severityname+`

`+o.errorname+`  
`+o.errordescription+`  

Change severity to 
			[low](command:threatscope.changeSeverity?[${o.line},${JSON.stringify("\u043D\u0438\u0437\u043A\u0430\u044F")}]) 
			[medium](command:threatscope.changeSeverity?[${o.line},${JSON.stringify("\u0441\u0440\u0435\u0434\u043D\u044F\u044F")}])	
			[high](command:threatscope.changeSeverity?[${o.line},${JSON.stringify("\u0432\u044B\u0441\u043E\u043A\u0430\u044F")}])	
			[critical](command:threatscope.changeSeverity?[${o.line},${JSON.stringify("\u043A\u0440\u0438\u0442\u0438\u0447\u043D\u0430\u044F")}])
			[unknown](command:threatscope.changeSeverity?[${o.line},${JSON.stringify("\u043D\u0435_\u0443\u043A\u0430\u0437\u0430\u043D\u0430")}])   

Change severity to 
			[not Confirmed](command:threatscope.changeStatus?[${o.line},${JSON.stringify("\u043D\u0435_\u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u043E",null,1)}])	
			[confirmed](command:threatscope.changeStatus?[${o.line},${JSON.stringify("\u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u043E")}])`);l.isTrusted=!0;let f={range:c,hoverMessage:l};if(o.statusname.toLowerCase()==="\u043D\u0435 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u043E")e.push(f);else switch(o.severityname.toLowerCase()){case"low":case"\u043D\u0438\u0437\u043A\u0430\u044F":t.push(f);break;case"medium":case"\u0441\u0440\u0435\u0434\u043D\u044F\u044F":s.push(f);break;case"high":case"\u0432\u044B\u0441\u043E\u043A\u0430\u044F":i.push(f);break;case"critical":case"\u043A\u0440\u0438\u0442\u0438\u0447\u043D\u0430\u044F":n.push(f);break;case"unknown":case"\u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430":a.push(f);break;default:e.push(f);break}}),h.window.activeTextEditor&&(h.window.activeTextEditor.setDecorations(ye,e),h.window.activeTextEditor.setDecorations(ve,t),h.window.activeTextEditor.setDecorations(we,s),h.window.activeTextEditor.setDecorations(ge,i),h.window.activeTextEditor.setDecorations(_e,n),h.window.activeTextEditor.setDecorations(Se,a))}async function G(r){return r===void 0?void 0:(await te.query(`select "Errorlist".errorname,"Errorlist".errordescription,"Recordlist".description,"Recordlist"."location","Recordlist".line,"Severity".severityname,"Status".statusname,"Users".username from "Markups" join "Recordlist" ON "Recordlist".record_id = "Markups".record_id join "Errorlist" ON "Errorlist".error_id = "Recordlist".error_id join "Severity" ON "Severity".severity_id = "Markups".severity_id join "Status" ON "Status".status_id = "Markups".status_id join "Users" ON "Users".user_id = "Markups".user_id where lower("Recordlist"."location") = lower('${r}')  ORDER by line`)).rows}var Ee=class{errorsData=[];m_onDidChangeTreeData=new h.EventEmitter;onDidChangeTreeData=this.m_onDidChangeTreeData.event;constructor(){h.commands.registerCommand("errorTree.refresh",e=>this.refresh()),h.commands.registerCommand("errorTree.onItemClicked",e=>this.onItemClicked(e)),h.commands.registerCommand("errorTree.changeToNotConfirmed",e=>this.changeToNotConfirmed(e)),h.commands.registerCommand("errorTree.changeToConfirmed",e=>this.changeToConfirmed(e)),h.commands.registerCommand("errorTree.changeToLowSeverity",e=>this.changeToLowSeverity(e)),h.commands.registerCommand("errorTree.changeToMediumSeverity",e=>this.changeToMediumSeverity(e)),h.commands.registerCommand("errorTree.changeToHighSeverity",e=>this.changeToHighSeverity(e)),h.commands.registerCommand("errorTree.changeToCriticalSeverity",e=>this.changeToCriticalSeverity(e)),h.commands.registerCommand("errorTree.changeToUnknownSeverity",e=>this.changeToUnknownSeverity(e))}changeToNotConfirmed(e){this.changeStatus(e,"\u043D\u0435 \u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u043E"),h.window.showInformationMessage("changed to not confirmed")}changeToConfirmed(e){this.changeStatus(e,"\u043F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u043E"),h.window.showInformationMessage("changed to confirmed")}changeToLowSeverity(e){this.changeSeverity(e,"\u043D\u0438\u0437\u043A\u0430\u044F"),h.window.showInformationMessage("Changed to low severity")}changeToMediumSeverity(e){this.changeSeverity(e,"\u0441\u0440\u0435\u0434\u043D\u044F\u044F"),h.window.showInformationMessage("Changed to medium severity")}changeToHighSeverity(e){this.changeSeverity(e,"\u0432\u044B\u0441\u043E\u043A\u0430\u044F"),h.window.showInformationMessage("changed to high severity")}changeToCriticalSeverity(e){this.changeSeverity(e,"\u043A\u0440\u0438\u0442\u0438\u0447\u043D\u0430\u044F"),h.window.showInformationMessage("changed to critical severity")}changeToUnknownSeverity(e){this.changeSeverity(e,"\u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u0430"),h.window.showInformationMessage("Changed to unknown severity")}async changeSeverity(e,t){let s=h.window.activeTextEditor?.document.uri.fsPath.toLowerCase(),i=e.line;await ys(i,t);let n=await G(s);this.refresh(n),j(n)}async changeStatus(e,t){let s=h.window.activeTextEditor?.document.uri.fsPath.toLowerCase(),i=e.line;await vs(i,t);let n=await G(s);this.refresh(n),j(n)}onItemClicked(e){if(h.window.activeTextEditor===void 0)return;let t=h.window.activeTextEditor,s=e.line,i=new h.Position(s-1,0);t.selection=new h.Selection(i,i),t.revealRange(new h.Range(i,i))}refresh(e){e!==void 0&&(this.errorsData=[],e.forEach(t=>{t.location.toLowerCase()===h.window.activeTextEditor?.document.uri.fsPath.toLowerCase()&&(this.errorsData.push(new D("["+t.line+"] "+t.errorname,t.line)),this.errorsData.at(-1)?.addChild(new D("Status: "+t.statusname,t.line)),this.errorsData.at(-1)?.addChild(new D("Severity: "+t.severityname,t.line)),this.errorsData.at(-1)?.addChild(new D("Description: "+t.errordescription,t.line)))})),this.m_onDidChangeTreeData.fire(void 0)}getTreeItem(e){let t=e.label?e.label.toString():"",s=new h.TreeItem(e.label,e.collapsibleState);return s.command={command:"errorTree.onItemClicked",title:t,arguments:[e]},s}getChildren(e){return e===void 0?this.errorsData:e.children}};async function ys(r,e){let t=h.window.activeTextEditor?.document.uri.fsPath.toLowerCase();await te.query(`update "Markups" set severity_id = (select severity_id from "Severity" where lower(severityname) = lower('${e}')),
	user_id = (select user_id from "Users" where lower(username) = lower('${g.get("DB.Login")}')) 
	where record_id = (select record_id from "Recordlist" where lower(location) = lower('${t}') and line = '${r}')`)}async function vs(r,e){let t=h.window.activeTextEditor?.document.uri.fsPath.toLowerCase();await te.query(`update "Markups" set status_id = (select status_id from "Status" where lower(statusname) = lower('${e}')), 
	user_id = (select user_id from "Users" where lower(username) = lower('${g.get("DB.Login")}')) 
	where record_id = (select record_id from "Recordlist" where lower(location) = lower('${t}') and line = '${r}')`)}var D=class extends h.TreeItem{label;children=[];line;constructor(e,t){super(e,h.TreeItemCollapsibleState.None),this.label=e,this.collapsibleState=h.TreeItemCollapsibleState.None,this.line=t}addChild(e){this.collapsibleState=h.TreeItemCollapsibleState.Collapsed,this.children.push(e)}};function Sa(){te.end()}0&&(module.exports={ErrorTreeItem,ErrorsProvider,activate,deactivate});
